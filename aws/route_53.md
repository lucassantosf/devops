# Configuring a domain into Load Balancer

## Create your Hosted Zone

1. Search for Route 53 service, click on 'Hosted Zones', and 'Created hosted zone'

2. Insert the 'domain name' 

    - *without www

    - Type 'Public hosted zone'

    - Click on 'Created hosted zone' button;

2. After, enter on details your domain , clicking on it

3. Copy the four default values of Type NS generated by AWS

    - Configure it in your "Domain Management Service"

    *It can be done in AWS, but you can have other external service

## Redirecting your domain to the Load Balancer

1. To configure the Load Balancer in this hosted zone, create a new register

    - Click on 'Create Record'

    - Record Name can be null, because we're configuring the root path of your domain into ELB

    - Record type - A

    - Toggle 'Alias' enabled

    - In 'Route traffic to'

        - Cloose endpoint - 'Alias to Application and Classic Load Balancer'

            - Select the region 

            - Select the Load Balancer 

    - Routing policy - Simple routing 

    - Click on 'Create Record' button to finish

2. This is the basic to configure the ELB on HTTP mode

3. Test it, the basic HTTP must work from your domain to your ELB

## Configure the www domain

1. To configure the www domain

    - Click on 'Create Record'

    - Record type - CNAME

    - Value : 

        Insert your root domain without www

    - Click on 'Create Record' button to finish

2. Test it, the basic HTTP must work from your www.domain to your ELB

## Configure SSL in your domain

1. Search for 'Certificate Manager' service

2. List certificates

3. Click on 'Request'

4. Select option 'Request a public certificate', Next

5. In Fully qualified domain name: 

    *.yourdomain.com

    - Add another one:

    yourdomain.com

    - Next

6. By default, let Validation Method on 'DNS validation - recommended'

7. Finish clicking on 'Request'

8. After requested, click on details, and copy the value CNAME name of yourdomain.com generated

9. Go back on 'Route 53' , enter in details your domain

10. Create a new record:

    - Record name - paste the value here 

    - Type CNAME

    - Value: paste the value from CNAME value from previous step

## Configure listener in ELB to the SSL

    First of all, the certificate must be verifyed , if no, the following steps won't happen.

1. Look for your load balancer , and add a new listener

2. Select Protocol HTTPS , port 443

3. Select the Certificate SSL you have created before, in area (Certificate (from ACM))

4. Routing actions: Select the Target Group you are working on

5. Finish clickink on 'Add' Button

6. Delete your listener from the Port 80, to deny access HTTP in your ELB

7. Go to ELB's Security Group and add the port 443 to it, removing the 80

9. Test your domain with (Must Work)

    https://www.domain.com.br/api/ping    https://domain.com.br/api/ping
    
10. Test your domain with (Mustn't Work)

    http://www.domain.com.br/api/ping    http://domain.com.br/api/ping


    -*It shouldn't work because you removed the port 80 from SG

## Redirect all HTTP traffic to HTTPS ( Optional )

1. Look for your load balancer , and add a new listener

2. Select Protocol HTTP , port 80

3. Routing actions

    - Redirect to URL

    - Protocol HTTPS, port 443

    - Status code 301

3. In the SG, allow the port 80 again

# Helpfuls :

https://www.youtube.com/watch?v=ma5n_5sOePw&list=PLOF5f9_x-OYUaqJar6EKRAonJNSHDFZUm&index=14